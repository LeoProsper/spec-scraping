# { spec64 } - Google Maps Lead Generator ğŸš€

Sistema SaaS completo para buscar empresas no Google Maps, extrair dados detalhados (incluindo avaliaÃ§Ãµes e comentÃ¡rios de clientes), analisar presenÃ§a digital e gerar propostas comerciais automatizadas.

## â­ Destaques do Projeto

- âš¡ **Ultra-rÃ¡pido:** 8-12x mais rÃ¡pido que scrapers convencionais (2-3s para 12 lugares)
- ğŸ“Š **50+ campos de dados:** Inclui avaliaÃ§Ãµes, comentÃ¡rios, fotos, horÃ¡rios, CNPJ e dados da Receita Federal
- ğŸ¯ **Taxa de sucesso:** 70-85% na extraÃ§Ã£o de CNPJs com validaÃ§Ã£o oficial
- ğŸ¢ **Dados oficiais:** IntegraÃ§Ã£o com API da Receita Federal (40+ campos)
- ğŸ¨ **Interface moderna:** UI conversacional com resultados em tempo real
- ğŸ”’ **ProduÃ§Ã£o-ready:** AutenticaÃ§Ã£o, banco de dados, histÃ³rico e cache inteligente

## ğŸ¯ Funcionalidades Principais

### Scraping AvanÃ§ado (V3 - Playwright)
- ğŸš€ **ExtraÃ§Ã£o ultra-rÃ¡pida:** Processamento paralelo em lotes de 3
- ğŸ“‹ **50+ campos extraÃ­dos:** Nome, endereÃ§o, telefone, website, rating, reviews
- ğŸ’¬ **AvaliaÃ§Ãµes completas:** AtÃ© 5 reviews com autor, nota e comentÃ¡rio
- ğŸ“¸ **Galeria de imagens:** AtÃ© 10 fotos por estabelecimento
- â° **Dados operacionais:** HorÃ¡rios, preÃ§os, acessibilidade, amenidades
- ğŸ” **ExtraÃ§Ã£o inteligente:** JSON parsing + fallback DOM (100% cobertura)

### Sistema de CNPJ e Receita Federal
- ğŸ†” **CNPJ Scraper:** 3 estratÃ©gias paralelas (Google Search, Maps, Website)
- âœ… **ValidaÃ§Ã£o oficial:** Algoritmo de dÃ­gitos verificadores
- ğŸ¢ **40+ campos da Receita:** RazÃ£o social, sÃ³cios (QSA), situaÃ§Ã£o cadastral
- ğŸ’¼ **Dados fiscais:** Simples Nacional, MEI, CNAEs, capital social
- ğŸ“ **EndereÃ§o completo:** Dados oficiais da Receita Federal

### Interface e ExperiÃªncia
- ğŸ’¬ **Chat conversacional:** Interface intuitiva para buscas
- ğŸ“Š **Tabela profissional:** TanStack Table com linhas expansÃ­veis
- ğŸ“œ **HistÃ³rico inteligente:** Cache de resultados com navegaÃ§Ã£o instantÃ¢nea
- ğŸ¨ **Design moderno:** Shadcn UI + Tailwind CSS + Motion animations
- âš¡ **Tempo real:** Loading states e atualizaÃ§Ãµes instantÃ¢neas

## ğŸ› ï¸ Stack TecnolÃ³gica

### Frontend
- **[Next.js 15.5.4](https://nextjs.org/)** - React framework com App Router e React 19
- **[Tailwind CSS v4](https://tailwindcss.com/)** - EstilizaÃ§Ã£o utility-first
- **[Shadcn UI](https://shadcn.com/)** - Componentes UI modernos e acessÃ­veis
- **[TanStack Table 8.21.3](https://tanstack.com/table)** - Tabelas avanÃ§adas com expansÃ£o
- **[Motion 12.23.24](https://motion.dev/)** - AnimaÃ§Ãµes suaves
- **[Lucide React](https://lucide.dev/)** - Ãcones modernos
- **[date-fns](https://date-fns.org/)** - ManipulaÃ§Ã£o de datas

### Backend & Scraping
- **[Playwright](https://playwright.dev/)** - Web scraping ultra-rÃ¡pido (30-50% mais rÃ¡pido que Puppeteer)
- **[Express](https://expressjs.com/)** - Servidor API do scraper (porta 3001)
- **[consulta-cnpj-ws](https://www.npmjs.com/package/consulta-cnpj-ws)** - IntegraÃ§Ã£o com API da Receita Federal

### Database & Auth
- **[Supabase PostgreSQL](https://supabase.com/)** - Banco de dados com auth integrado
- **[Docker](https://www.docker.com/)** - Container para Supabase local

### Dev Tools
- **[TypeScript 5.x](https://www.typescriptlang.org/)** - Type safety completo
- **[Turborepo](https://turborepo.org/)** - Monorepo com cache inteligente
- **[ESLint v9](https://eslint.org/)** - Linting
- **[Prettier](https://prettier.io/)** - FormataÃ§Ã£o de cÃ³digo
- **[Zod](https://github.com/colinhacks/zod)** - ValidaÃ§Ã£o de schemas

## ğŸ“Š Performance e MÃ©tricas

### Scraper V3 (Atual)
- âš¡ **Velocidade:** 2-3s para 12 lugares (8-12x mais rÃ¡pido que V1)
- âš¡ **Processamento:** Paralelo em lotes de 3
- âš¡ **Taxa de sucesso JSON:** 60-70% dos casos
- âš¡ **Cobertura total:** 100% (JSON + fallback DOM)
- âš¡ **Campos extraÃ­dos:** 50+ por estabelecimento
- âš¡ **Reviews:** AtÃ© 5 por lugar
- âš¡ **Imagens:** AtÃ© 10 fotos

### CNPJ e Receita Federal
- ğŸ†” **Taxa de extraÃ§Ã£o CNPJ:** 70-85%
- ğŸ¢ **Taxa de enriquecimento:** 70-85%
- â±ï¸ **Tempo individual:** 2-4s por CNPJ
- â±ï¸ **Tempo em lote (12):** 24-48s
- ğŸ“‹ **Campos da Receita:** 40+ campos oficiais

### Rate Limiting
- ğŸ›¡ï¸ **Google Maps:** 1 requisiÃ§Ã£o/minuto por IP
- ğŸ›¡ï¸ **Receita Federal:** 2.5s delay entre requisiÃ§Ãµes
- ğŸ”’ **ProteÃ§Ã£o:** Evita bloqueios automÃ¡ticos

## ğŸš€ Como Executar

### PrÃ©-requisitos

- **Node.js 24.11.0** ou superior
- **Docker** (para Supabase local)
- **PNPM** (gerenciador de pacotes)

Certifique-se de ter o Docker rodando na sua mÃ¡quina antes de iniciar.

### InstalaÃ§Ã£o

#### 1. Clone o repositÃ³rio

```bash
git clone https://github.com/LeoProsper/spec-scraping.git
cd spec-scraping
```

#### 2. Instale as dependÃªncias

```bash
pnpm install
```

#### 3. Inicie o Supabase

Certifique-se de ter o Docker rodando:

```bash
docker compose up -d
# ou
pnpm run supabase:web:start
```

O Supabase Dashboard estarÃ¡ disponÃ­vel em [http://localhost:54323](http://localhost:54323).

**Porta do PostgreSQL:** 54321  
**Container:** `supabase_db_next-supabase-saas-kit-turbo-lite`

#### 4. Inicie o Scraper (em outro terminal)

```bash
cd ../projeto-google-find/server
node index-ultra-fast.js
```

**Porta:** 3001  
**Output:** Logs detalhados com emojis  
**Modo:** Headless (nÃ£o abre navegador)

Aguarde a mensagem: `ğŸš€ Scraper API rodando na porta 3001`

#### 5. Inicie o Next.js (em outro terminal)

```bash
cd novo
pnpm run dev
```

**Porta:** 3000  
**Turbopack:** Ativado para hot reload rÃ¡pido

#### 6. Acesse a aplicaÃ§Ã£o

Abra seu navegador em [http://localhost:3000](http://localhost:3000)

**UsuÃ¡rio de teste:**
- Email: `lelevitormkt@gmail.com`
- Senha: `password123`

### Comandos Ãšteis

```bash
# Parar Supabase
docker compose down
# ou
pnpm run supabase:web:stop

# Resetar banco de dados
pnpm run supabase:web:reset

# Verificar status dos servidores
# PowerShell:
Test-NetConnection -ComputerName localhost -Port 3000,3001
```

## ğŸ“ Estrutura do Banco de Dados

### Tabelas Principais

**`companies`** - Empresas extraÃ­das (53 campos)
- Dados bÃ¡sicos: nome, endereÃ§o, telefone, website
- AvaliaÃ§Ãµes: rating, reviews_count, top_reviews (JSONB)
- MÃ­dia: images (atÃ© 10 fotos)
- Operacional: opening_hours, price_level, about
- Acessibilidade: accessibility, amenities, service_options
- **CNPJ:** cnpj (14 dÃ­gitos validados)
- **Receita Federal (26 campos):** razÃ£o_social, nome_fantasia, situacao_cadastral, qsa (sÃ³cios), capital_social, cnaes_secundarios, etc.

**`searches`** - HistÃ³rico de buscas
- Query, parÃ¢metros, status
- **results (JSONB):** Cache completo dos resultados
- Total de lugares encontrados

**`users`** - UsuÃ¡rios do sistema
- AutenticaÃ§Ã£o via Supabase Auth
- Limites de busca e estatÃ­sticas

### MigraÃ§Ãµes Aplicadas

```bash
# Campos avanÃ§ados do Google Maps (12 novos campos)
migration-advanced-fields.sql

# CNPJ
migration-cnpj-field.sql

# Dados da Receita Federal (26 novos campos)
migration-receita-fields.sql

# Cache de resultados
migration-search-results.sql
```

## ğŸ“ Estrutura do Projeto

```
novo/                                    # Projeto Next.js
â”œâ”€â”€ apps/
â”‚   â””â”€â”€ web/
â”‚       â”œâ”€â”€ app/
â”‚       â”‚   â”œâ”€â”€ home/
â”‚       â”‚   â”‚   â””â”€â”€ scout/              # Sistema de busca
â”‚       â”‚   â”‚       â””â”€â”€ chat/
â”‚       â”‚   â”‚           â””â”€â”€ _components/
â”‚       â”‚   â”‚               â”œâ”€â”€ chat-welcome.tsx      # Interface de busca
â”‚       â”‚   â”‚               â””â”€â”€ results-table.tsx     # Tabela de resultados
â”‚       â”‚   â””â”€â”€ api/
â”‚       â”‚       â”œâ”€â”€ scout/
â”‚       â”‚       â”‚   â””â”€â”€ search/route.ts               # Endpoint de busca
â”‚       â”‚       â””â”€â”€ conversations/
â”‚       â”‚           â””â”€â”€ [id]/messages/route.ts        # Salvamento no banco
â”‚       â”œâ”€â”€ components/
â”‚       â”‚   â””â”€â”€ app-logo.tsx                          # Logo { spec64 }
â”‚       â””â”€â”€ supabase/
â”‚           â””â”€â”€ migrations/                           # MigraÃ§Ãµes SQL
â”‚
â”œâ”€â”€ packages/
â”‚   â””â”€â”€ features/
â”‚       â””â”€â”€ kaix-scout/
â”‚           â””â”€â”€ src/
â”‚               â”œâ”€â”€ types/index.ts                    # Types TypeScript
â”‚               â””â”€â”€ services/
â”‚                   â””â”€â”€ google-maps-scraper.service.ts # Client do scraper
â”‚
projeto-google-find/                     # Scraper standalone
â””â”€â”€ server/
    â”œâ”€â”€ index-ultra-fast.js              # â­ Scraper V3 (Playwright)
    â”œâ”€â”€ cnpj-scraper.js                  # CNPJ extractor
    â””â”€â”€ cnpj-enrichment.js               # Receita Federal API
```

## ğŸ”„ Fluxo de Dados

### 1. Busca no Google Maps
```
Frontend (chat-welcome.tsx)
    â†“
POST /api/scout/search
    â†“
searchPlaces() (google-maps-scraper.service.ts)
    â†“
POST http://localhost:3001/api/scrape-maps
    â†“
Playwright Scraper (index-ultra-fast.js)
    â†“ ExtraÃ§Ã£o JSON/DOM - 50+ campos
    â†“ CNPJ Scraper (3 estratÃ©gias)
    â†“ Receita Federal API (40+ campos)
Retorna { businesses: [...] }
    â†“ Mapeamento para GoogleMapsPlace
Retorna { places: [...], total: N }
    â†“
Frontend exibe ResultsTable
```

### 2. Salvamento no Banco
```
POST /api/conversations/[id]/messages
    â†“
processSearchInBackground()
    â†“
searchPlaces() â†’ dados do scraper
    â†“
companies.map() â†’ 53 campos completos
    â†“
supabase.from('companies').insert(companies)
    â†“
Dados persistidos com reviews, images, CNPJ, Receita, etc.
```

### 3. HistÃ³rico e Cache
```
Click no histÃ³rico
    â†“
router.push(?searchId=uuid)
    â†“
GET /api/scout/searches/[id]
    â†“
search.results (JSONB) â†’ cached places
    â†“
setSearchResults() â†’ ResultsTable instantÃ¢neo (sem re-scraping)
```

## âš™ï¸ VariÃ¡veis de Ambiente

Configure no arquivo `.env.local`:

| VariÃ¡vel | DescriÃ§Ã£o | Valor PadrÃ£o |
| --- | --- | --- |
| `NEXT_PUBLIC_SITE_URL` | URL da aplicaÃ§Ã£o | `http://localhost:3000` |
| `NEXT_PUBLIC_PRODUCT_NAME` | Nome do produto | `{ spec64 }` |
| `NEXT_PUBLIC_SUPABASE_URL` | URL do Supabase | `http://127.0.0.1:54321` |
| `NEXT_PUBLIC_SUPABASE_ANON_KEY` | Chave pÃºblica do Supabase | (auto-gerada) |
| `SUPABASE_SERVICE_ROLE_KEY` | Chave de serviÃ§o do Supabase | (auto-gerada) |

## ğŸ¯ Exemplo de Dados ExtraÃ­dos

### Request
```json
{
  "query": "restaurante italiano",
  "city": "sÃ£o paulo",
  "maxPlaces": 12
}
```

### Response (1 estabelecimento)
```json
{
  "name": "Famiglia Mancini Trattoria",
  "place_id": "ChIJXxY...",
  "cid": "1234567890",
  "cnpj": "12.345.678/0001-90",
  "coordinates": {
    "latitude": -23.5505,
    "longitude": -46.6333
  },
  "address": "Rua Avanhandava, 81 - Bela Vista, SÃ£o Paulo - SP",
  "rating": 4.7,
  "reviews_count": 15234,
  "categories": ["Restaurante italiano", "Restaurante"],
  "website": "https://www.famigliamancini.com.br",
  "phone": "(11) 3256-4320",
  "link": "https://maps.google.com/?cid=...",
  "opening_hours": "Seg-Dom: 12h-15h, 19h-23h",
  "price_level": 3,
  "images": ["https://lh3.googleusercontent.com/...", "..."],
  "top_reviews": [
    {
      "author": "Natalia Cerrao",
      "rating": "5",
      "text": "Tive o prazer conhecer a Famiglia Mancini...",
      "time": "hÃ¡ 2 meses"
    }
  ],
  "accessibility": ["Entrada acessÃ­vel para cadeirantes"],
  "amenities": ["Wi-Fi gratuito", "Estacionamento"],
  "service_options": ["Delivery", "Para viagem", "Comer no local"],
  
  // Dados da Receita Federal
  "razao_social": "FAMIGLIA MANCINI RESTAURANTE LTDA",
  "nome_fantasia": "FAMIGLIA MANCINI TRATTORIA",
  "situacao_cadastral": "ATIVA",
  "porte_empresa": "DEMAIS",
  "capital_social": "R$ 500.000,00",
  "qsa": [
    {
      "nome": "JOÃƒO DA SILVA",
      "qualificacao": "SÃ³cio-Administrador",
      "data_entrada": "01/01/2000"
    }
  ]
}
```

## ğŸ—ï¸ Arquitetura

### Monorepo (Turborepo)
- **apps/web:** AplicaÃ§Ã£o Next.js principal
- **packages/features:** Features modulares (auth, scout, etc)
- **packages/ui:** Componentes UI compartilhados

### Scraper Standalone
- **Servidor Express independente** (porta 3001)
- **Playwright para scraping ultra-rÃ¡pido**
- **APIs separadas para CNPJ e Receita Federal**

### Database (Supabase PostgreSQL)
- **Migrations versionadas** em `apps/web/supabase/migrations/`
- **Row Level Security (RLS)** para seguranÃ§a
- **JSONB para dados flexÃ­veis** (reviews, images, QSA)

## ğŸš€ Deploy para ProduÃ§Ã£o

### 1. Criar Projeto no Supabase
Crie um projeto em [supabase.com](https://supabase.com)

### 2. Aplicar MigraÃ§Ãµes
```bash
# Link ao projeto remoto
pnpm --filter web supabase link

# Push das migraÃ§Ãµes
pnpm --filter web supabase db push
```

### 3. Configurar Callback URL
No painel do Supabase, adicione:
```
https://seu-dominio.com/auth/callback
```

### 4. Deploy do Scraper
O scraper precisa rodar em um servidor separado (VPS, Railway, Render, etc):
```bash
# Instalar Playwright
cd projeto-google-find/server
npm install
npx playwright install chromium

# Rodar com PM2 (recomendado)
pm2 start index-ultra-fast.js --name scraper
pm2 save
```

### 5. Deploy do Next.js

**Vercel (recomendado):**
```bash
vercel --prod
```

**Cloudflare Pages:**
- Configure `runtime = 'edge'` em `app/layout.tsx`
- Habilite Node.js compatibility

**VariÃ¡veis de ambiente necessÃ¡rias:**
```env
NEXT_PUBLIC_SITE_URL=https://seu-dominio.com
NEXT_PUBLIC_SUPABASE_URL=https://xxx.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJ...
SUPABASE_SERVICE_ROLE_KEY=eyJ...
```

## Contributing

Contributions for bug fixed are welcome! However, please open an issue first to discuss your ideas before making a pull request.

## License

This project is licensed under the MIT License. See the [LICENSE](LICENSE) file for more details.

## Support

No support is provided for this kit. Feel free to open an issue if you have any questions or need help, but there is no guaranteed response time, nor guarantee a fix.

For dedicated support, priority fixes, and advanced features, [check out our full version](https://makerkit.dev).
